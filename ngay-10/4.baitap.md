# Chức năng authentication, user

<details>
<summary><h3 style="display: inline-block;">2. Viết api đăng ký</h3></summary>

POST: `/register`

```json
{
    "name": "required",
    "email": "required" , "email",
    "password": "required" , "password rule",
}
```

<h4>Logic: </h4>


1. Validate thông tin name, email, password

2. Kiểm tra xem email đã tồn tại trên hệ thống hay chưa -> Thông báo lỗi
3. Hash Password
4. Generate code để gắn vào email
5. Tạo user với đầy đủ thông tin và code, và verify = false
6. Gửi email xác nhận đăng ký tài khoản, có kèm link kích hoạt tài khoản
7. Response thông gửi mail thành công về client
</details>

<details>
    <summary><h3 style="display: inline-block;">3. Viết api đăng nhập</h3></summary>
<h4>Logic:</h4>

POST: `/login`

1. Validate thông tin email, password

2. Hash password và tìm theo email và password được hash

3. Trả lỗi về client nếu không tìm thấy, lưu ý không trả về lỗi cụ thể 

4. Generate accessToken, refreshToken có chứa user id

5. Lưu refreshToken vào DB

6. Response về client accessToken, refreshToken
</details>
<details>
    <summary><h3 style="display: inline-block;">4. Viết api cập nhật thông tin cá nhân</h3></summary>
<h4>Logic:</h4>

*Yêu cầu Authorization

1. Validate những field truyền bằng body: name, birthday, avatar

2. Cập nhật và response về client thông tin thành công / thất bại
</details>
<details>
    <summary><h3 style="display: inline-block;">5. Viết api thay đổi mật khẩu</h3></summary>

<h4>Logic:</h4>

*Yêu cầu Authorization

1. Thêm field `changePasswordHistories` = [{ password: String, changeAt: Date }] vào Model để lưu thông tin thay đổi mật khẩu

2. Validate oldPassword và newPassword, yêu cầu không được giống nhau và đủ độ mạnh

3. Kiểm tra newPassword nằm trong những password đã thay đổi trong khoảng 6 tháng gần nhất hay không, nếu có thì throw Error

4. Thay đổi theo mật khẩu mới

5. Thêm vào `changePasswordHistories` thông tin password mới thay đổi và thời gian thay đổi

6. Response về client

</details>
<details>
    <summary><h3 style="display: inline-block;">6. Viết api tìm lại mật khẩu qua email</h3></summary>

<h4>Logic:</h4>


</details>

# Yêu cầu phi chức năng (Non-functional requirement)

1. Giới hạn những chức năng gửi mail trong 60s, không cho phép gửi liên tục
2. Cho phép enabled / disabled từng session của user, tương tự với refresh token
3. Không cho phép user thay đổi mật khẩu thay đổi trong khoảng 6 tháng gần nhất
4. Đăng nhập vĩnh viễn
5. Làm 2 email template: register, reset password

# Chức năng nâng cao

1. Đăng ký / Đăng nhập thông qua gmail, tạo mật khẩu lần đầu tiên khi user đăng nhập
2. Lưu lại lịch sử đăng nhập
3. Cho phép đăng nhập trên nhiều thiết bị, enabled / disabled trên từng thiết bị
4. Lưu lại lần đăng nhập cuối trên từng thiết bị
5. Hạn chế số lần nhập password sai, quá 5 lần thì phải chờ 3 phút mới đăng nhập lại
6. Khi thay đổi mật khẩu, tất cả thiết bị đã từng đăng nhập bắt buộc phải đăng nhập lại
7. Chức năng khóa tài khoản
8. Chức năng xóa tài khoản: Tài khoản sẽ được đưa vào chờ xóa, trong khoảng thời gian chờ xóa nếu đăng nhập lại thì kích hoạt lại tài khoản
9. Tạo mã đăng nhập 1 lần
10. Bảo mật 2 lớp (OTP qua email hoặc số điện thoại), cảnh báo đăng nhập trên những thiết bị lạ
